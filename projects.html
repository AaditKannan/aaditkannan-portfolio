<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  
  <!-- Primary Meta Tags -->
  <title>Aadit Kannan | Projects</title>
  <meta name="title" content="Aadit Kannan | Projects">
  <meta name="description" content="Explore Aadit Kannan's engineering projects - from Formula Electric battery systems to robotics, flood detection, and web development.">
  <meta name="keywords" content="Aadit Kannan projects, engineering projects, robotics, Formula Electric, UC Berkeley, portfolio">
  <meta name="author" content="Aadit Kannan">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://aaditkannan.com/projects">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://aaditkannan.com/projects">
  <meta property="og:title" content="Aadit Kannan | Projects">
  <meta property="og:description" content="Explore Aadit Kannan's engineering projects.">
  <meta property="og:image" content="https://aaditkannan.com/assets/photo.jpg">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://aaditkannan.com/projects">
  <meta property="twitter:title" content="Aadit Kannan | Projects">
  <meta property="twitter:description" content="Explore Aadit Kannan's engineering projects.">
  <meta property="twitter:image" content="https://aaditkannan.com/assets/photo.jpg">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon-simple.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-dark: #000000;
      --text-white: #FFFFFF;
      --text-gray: #666;
      --text-light: #999;
      --border-subtle: rgba(255, 255, 255, 0.08);
      --border-hover: rgba(255, 255, 255, 0.2);
    }

    html, body {
      overflow: hidden;
      height: 100%;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    html::-webkit-scrollbar, body::-webkit-scrollbar {
      display: none;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-dark);
      color: var(--text-white);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Subtle dot grid background */
    .bg-pattern {
      position: fixed;
      inset: 0;
      background-image: radial-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px);
      background-size: 32px 32px;
      z-index: -1;
    }

    /* Navigation Bar */
    .nav-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1001;
      padding: 24px 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.95) 0%, transparent 100%);
      height: 80px;
      box-sizing: border-box;
    }

    .nav-link {
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      transition: all 0.3s ease;
      padding: 8px 0;
      border: none;
      border-bottom: 1px solid transparent;
      background: transparent;
      font-family: 'Courier Prime', 'JetBrains Mono', 'Courier New', monospace;
    }

    .nav-link:hover {
      color: #FFFFFF;
      border-bottom-color: rgba(255, 255, 255, 0.5);
    }

    .nav-link.active {
      color: #FFFFFF;
      border-bottom-color: #FFFFFF;
    }

    /* Canvas container */
    #graphCanvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      cursor: grab;
    }

    #graphCanvas:active {
      cursor: grabbing;
    }

    /* Project detail panel */
    .project-panel {
      position: fixed;
      top: 100px;
      right: -450px;
      width: 400px;
      max-height: calc(100vh - 140px);
      background: rgba(0, 0, 0, 0.95);
      border: 1px solid var(--border-subtle);
      border-radius: 2px;
      padding: 40px;
      z-index: 1000;
      transition: right 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      overflow-y: auto;
      backdrop-filter: blur(20px);
    }

    .project-panel.visible {
      right: 30px;
    }

    .project-panel-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 28px;
      height: 28px;
      background: transparent;
      border: 1px solid var(--border-subtle);
      border-radius: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .project-panel-close:hover {
      border-color: var(--border-hover);
    }

    .project-panel-close::before,
    .project-panel-close::after {
      content: '';
      position: absolute;
      width: 12px;
      height: 1px;
      background: #fff;
    }

    .project-panel-close::before {
      transform: rotate(45deg);
    }

    .project-panel-close::after {
      transform: rotate(-45deg);
    }

    .project-category {
      display: inline-block;
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-gray);
      margin-bottom: 16px;
      font-family: 'Courier Prime', monospace;
    }

    .project-title {
      font-family: 'Inter', sans-serif;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
      line-height: 1.3;
      letter-spacing: -0.02em;
    }

    .project-date {
      font-size: 13px;
      color: var(--text-gray);
      margin-bottom: 28px;
      font-family: 'Courier Prime', monospace;
    }

    .project-description {
      font-size: 14px;
      line-height: 1.8;
      color: var(--text-light);
      margin-bottom: 28px;
    }

    .project-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .project-tag {
      padding: 6px 12px;
      background: transparent;
      border: 1px solid var(--border-subtle);
      font-size: 11px;
      color: var(--text-gray);
      font-family: 'Courier Prime', monospace;
      letter-spacing: 0.05em;
    }

    /* Instructions */
    .instructions {
      position: fixed;
      bottom: 30px;
      right: 30px;
      font-size: 11px;
      color: var(--text-gray);
      text-align: right;
      z-index: 100;
      font-family: 'Courier Prime', monospace;
      letter-spacing: 0.05em;
    }

    /* Node tooltip */
    .node-tooltip {
      position: fixed;
      padding: 8px 14px;
      background: rgba(0, 0, 0, 0.95);
      border: 1px solid var(--border-subtle);
      font-size: 12px;
      color: #fff;
      pointer-events: none;
      z-index: 1002;
      opacity: 0;
      transition: opacity 0.15s ease;
      font-family: 'Inter', sans-serif;
      letter-spacing: 0.02em;
    }

    .node-tooltip.visible {
      opacity: 1;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
      .nav-bar {
        padding: 20px 24px;
        gap: 24px;
        height: 70px;
      }

      .nav-link {
        font-size: 11px;
        letter-spacing: 0.1em;
      }

      .project-panel {
        top: auto;
        bottom: 0;
        right: 0;
        left: 0;
        width: 100%;
        max-height: 60vh;
        border-radius: 0;
        border-top: 1px solid var(--border-subtle);
        transform: translateY(100%);
        transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .project-panel.visible {
        right: 0;
        transform: translateY(0);
      }

      .instructions {
        display: none;
      }

      .project-title {
        font-size: 20px;
      }

      .project-description {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="bg-pattern"></div>

  <!-- Navigation Bar -->
  <nav class="nav-bar">
    <a href="/" class="nav-link">HOME</a>
    <a href="/resume" class="nav-link">RESUME</a>
    <a href="/projects" class="nav-link active">PROJECTS</a>
    <a href="/connect" class="nav-link">CONNECT</a>
    <a href="/footage" class="nav-link">FOOTAGE</a>
  </nav>

  <!-- Graph Canvas -->
  <canvas id="graphCanvas"></canvas>

  <!-- Node Tooltip -->
  <div class="node-tooltip" id="nodeTooltip"></div>

  <!-- Project Detail Panel -->
  <div class="project-panel" id="projectPanel">
    <button class="project-panel-close" id="panelClose" aria-label="Close"></button>
    <span class="project-category" id="panelCategory">Category</span>
    <h2 class="project-title" id="panelTitle">Project Title</h2>
    <p class="project-date" id="panelDate">2024 - Present</p>
    <p class="project-description" id="panelDescription">Project description goes here...</p>
    <div class="project-tags" id="panelTags"></div>
  </div>

  <!-- Instructions -->
  <div class="instructions">
    CLICK TO VIEW • DRAG TO PAN • SCROLL TO ZOOM
  </div>

  <script>
    // Project data
    const projects = [
      {
        id: 'formula-electric',
        title: 'Formula Electric',
        category: 'hardware',
        date: '2025 - Present',
        description: 'Designed and manufactured the attic casing for the high-voltage accumulator (battery) for Berkeley\'s Formula Electric racing team. Implemented waterproofing and high-dielectric-strength insulation to safely manage the 588V battery pack.',
        tags: ['CAD', 'Manufacturing', 'High Voltage', 'Composites'],
        connections: ['robotics-first', 'inventry'],
        size: 1.4
      },
      {
        id: 'robotics-first',
        title: 'Robotics (FIRST)',
        category: 'hardware',
        date: '2021 - 2025',
        description: 'Led robotics teams as Captain of Zenith #20424 and Hardware Lead of Deja Vu #13216. Mentored 30+ members in Java and CAD, designed robots with 500+ parts using FEA optimization, and won robot design awards 3 times. Raised over $5000 and developed team websites.',
        tags: ['CAD', 'FEA', 'Java', 'Leadership', 'Mentoring'],
        connections: ['inventry', 'pear-volunteering', 'formula-electric'],
        size: 1.3
      },
      {
        id: 'inventry',
        title: 'Inventry',
        category: 'software',
        date: '2025 - Present',
        description: 'Developed a website for robotics part inventory tracking, utilizing AI invoice indexing and dynamic webscraping for 1000+ part catalogs. Integrated part-lending service with incentives and extensive privacy measures. Currently developing a parts marketplace.',
        tags: ['Web Dev', 'AI', 'Webscraping', 'Database'],
        connections: ['robotics-first', 'pear-volunteering'],
        size: 1.2
      },
      {
        id: 'atlas-smr',
        title: 'Atlas SMR',
        category: 'research',
        date: '2024',
        description: 'Developed an interactive web tool to evaluate Small Modular Reactor (SMR) feasibility in rural areas, integrating geospatial data and weighted scoring to compare site viability. Added hybrid SMR–solar modeling to visualize energy demand, environmental constraints, and overall system potential.',
        tags: ['Web Dev', 'GIS', 'Energy', 'Data Viz'],
        connections: ['construction-acclimation', 'friendly-fires'],
        size: 1.1
      },
      {
        id: 'construction-acclimation',
        title: 'Construction Acclimation',
        category: 'research',
        date: '2022 - 2023',
        description: 'Gathered construction site data to develop alternative devices to costly acclimation probes, aiming to cut $118M from Palo Alto\'s spending. Built a website and functioning probe prototype that earned praise from city construction officials.',
        tags: ['Hardware', 'Data Collection', 'Web Dev', 'City Planning'],
        connections: ['atlas-smr', 'prototype-flood'],
        size: 1.0
      },
      {
        id: 'beachsweep',
        title: 'Beachsweep',
        category: 'hardware',
        date: '2023',
        description: 'Hackathon project designing a website for organizing drone beach cleanups. Utilized solar-powered drone docks that work to maintain beach cleanliness and collaborate with human initiatives. Designed a computer vision drone trash detection system.',
        tags: ['Drones', 'Computer Vision', 'Solar', 'Web Dev'],
        connections: ['friendly-fires', 'prototype-flood'],
        size: 1.0
      },
      {
        id: 'friendly-fires',
        title: 'Friendly Fires',
        category: 'social',
        date: '2021 - 2022',
        description: 'Created a mining tool attachment consisting of a compact sensor array capable of consistently detecting coal-seam fires, aiming to save lives in dangerous and often neglected mining conditions.',
        tags: ['Sensors', 'Safety', 'Hardware', 'Mining'],
        connections: ['prototype-flood', 'atlas-smr', 'beachsweep'],
        size: 1.0
      },
      {
        id: 'prototype-flood',
        title: 'Prototype Ø Flood',
        category: 'social',
        date: '2020 - 2021',
        description: 'Designed a low-cost flood detection system intended for addressing the lack of alert technology in Jakarta, Indonesia. Won certificate of achievement from the American Society of Civil Engineers.',
        tags: ['Sensors', 'IoT', 'Social Impact', 'International'],
        connections: ['friendly-fires', 'construction-acclimation', 'beachsweep'],
        size: 1.0
      },
      {
        id: 'pear-volunteering',
        title: 'Pear Volunteering',
        category: 'software',
        date: '2023 - 2025',
        description: 'Developed an app and website to connect 2000+ students, 20+ event organizers, and school admin for volunteer opportunities. Implemented secure webhook/CMS-integrated system for scalable, high-volume data handling and encrypted user communication.',
        tags: ['App Dev', 'Web Dev', 'CMS', 'Security'],
        connections: ['robotics-first', 'inventry'],
        size: 1.2
      }
    ];

    // Canvas setup
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');
    const tooltip = document.getElementById('nodeTooltip');
    const panel = document.getElementById('projectPanel');
    const panelClose = document.getElementById('panelClose');

    let width, height;
    let nodes = [];
    let edges = [];
    let offsetX = 0, offsetY = 0;
    let scale = 1;
    let isDragging = false;
    let dragStartX, dragStartY;
    let hoveredNode = null;
    let selectedNode = null;
    let animationFrame;
    let time = 0;

    // Physics simulation parameters
    const REPULSION = 18000;
    const ATTRACTION = 0.006;
    const DAMPING = 0.88;
    const CENTER_GRAVITY = 0.008;

    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width * window.devicePixelRatio;
      canvas.height = height * window.devicePixelRatio;
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';
      ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
    }

    function initNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.28;

      nodes = projects.map((project, i) => {
        const angle = (i / projects.length) * Math.PI * 2 - Math.PI / 2;
        return {
          ...project,
          x: centerX + Math.cos(angle) * radius + (Math.random() - 0.5) * 80,
          y: centerY + Math.sin(angle) * radius + (Math.random() - 0.5) * 80,
          vx: 0,
          vy: 0,
          baseRadius: 20 * (project.size || 1),
          phase: Math.random() * Math.PI * 2
        };
      });

      // Build edges from connections
      edges = [];
      nodes.forEach(node => {
        if (node.connections) {
          node.connections.forEach(targetId => {
            const target = nodes.find(n => n.id === targetId);
            if (target && !edges.find(e => 
              (e.source.id === node.id && e.target.id === targetId) ||
              (e.source.id === targetId && e.target.id === node.id)
            )) {
              edges.push({ source: node, target });
            }
          });
        }
      });
    }

    function simulate() {
      nodes.forEach(node => {
        // Repulsion between nodes
        nodes.forEach(other => {
          if (node === other) return;
          const dx = node.x - other.x;
          const dy = node.y - other.y;
          const dist = Math.sqrt(dx * dx + dy * dy) || 1;
          const force = REPULSION / (dist * dist);
          node.vx += (dx / dist) * force;
          node.vy += (dy / dist) * force;
        });

        // Center gravity
        const centerX = width / 2;
        const centerY = height / 2;
        node.vx += (centerX - node.x) * CENTER_GRAVITY;
        node.vy += (centerY - node.y) * CENTER_GRAVITY;
      });

      // Attraction along edges
      edges.forEach(edge => {
        const dx = edge.target.x - edge.source.x;
        const dy = edge.target.y - edge.source.y;
        const dist = Math.sqrt(dx * dx + dy * dy) || 1;
        const force = dist * ATTRACTION;
        edge.source.vx += (dx / dist) * force;
        edge.source.vy += (dy / dist) * force;
        edge.target.vx -= (dx / dist) * force;
        edge.target.vy -= (dy / dist) * force;
      });

      // Apply velocities with damping
      nodes.forEach(node => {
        node.vx *= DAMPING;
        node.vy *= DAMPING;
        node.x += node.vx;
        node.y += node.vy;
      });
    }

    function draw() {
      time += 0.016;
      ctx.clearRect(0, 0, width, height);
      ctx.save();
      ctx.translate(offsetX, offsetY);
      ctx.scale(scale, scale);

      // Draw edges
      edges.forEach(edge => {
        const dx = edge.target.x - edge.source.x;
        const dy = edge.target.y - edge.source.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        // Subtle animated dash
        ctx.beginPath();
        ctx.moveTo(edge.source.x, edge.source.y);
        ctx.lineTo(edge.target.x, edge.target.y);
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.06)';
        ctx.lineWidth = 1;
        ctx.stroke();

        // Small traveling dot
        const speed = 0.15;
        const progress = ((time * speed) % 1);
        const px = edge.source.x + dx * progress;
        const py = edge.source.y + dy * progress;
        
        ctx.beginPath();
        ctx.arc(px, py, 1.5, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.25)';
        ctx.fill();
      });

      // Draw nodes
      nodes.forEach(node => {
        const isHovered = node === hoveredNode;
        const isSelected = node === selectedNode;
        
        // Subtle breathing animation
        const breathe = Math.sin(time * 1.5 + node.phase) * 0.08 + 1;
        const nodeRadius = node.baseRadius * (isHovered ? 1.15 : isSelected ? 1.1 : breathe);

        // Outer glow for hovered/selected
        if (isHovered || isSelected) {
          const glowGradient = ctx.createRadialGradient(
            node.x, node.y, nodeRadius * 0.5,
            node.x, node.y, nodeRadius * 2.5
          );
          glowGradient.addColorStop(0, 'rgba(255, 255, 255, 0.15)');
          glowGradient.addColorStop(1, 'transparent');
          ctx.beginPath();
          ctx.arc(node.x, node.y, nodeRadius * 2.5, 0, Math.PI * 2);
          ctx.fillStyle = glowGradient;
          ctx.fill();
        }

        // Node ring
        ctx.beginPath();
        ctx.arc(node.x, node.y, nodeRadius, 0, Math.PI * 2);
        ctx.strokeStyle = isHovered || isSelected 
          ? 'rgba(255, 255, 255, 0.9)' 
          : 'rgba(255, 255, 255, 0.25)';
        ctx.lineWidth = isHovered || isSelected ? 1.5 : 1;
        ctx.stroke();

        // Inner fill
        ctx.beginPath();
        ctx.arc(node.x, node.y, nodeRadius - 1, 0, Math.PI * 2);
        ctx.fillStyle = isHovered || isSelected 
          ? 'rgba(255, 255, 255, 0.08)' 
          : 'rgba(255, 255, 255, 0.02)';
        ctx.fill();

        // Center dot
        ctx.beginPath();
        ctx.arc(node.x, node.y, 2, 0, Math.PI * 2);
        ctx.fillStyle = isHovered || isSelected 
          ? 'rgba(255, 255, 255, 0.9)' 
          : 'rgba(255, 255, 255, 0.4)';
        ctx.fill();

        // Node label
        ctx.font = `500 11px 'Inter', sans-serif`;
        ctx.fillStyle = isHovered || isSelected 
          ? 'rgba(255, 255, 255, 0.95)' 
          : 'rgba(255, 255, 255, 0.5)';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText(node.title, node.x, node.y + nodeRadius + 12);
      });

      ctx.restore();
      simulate();
      animationFrame = requestAnimationFrame(draw);
    }

    function getNodeAtPosition(x, y) {
      const transformedX = (x - offsetX) / scale;
      const transformedY = (y - offsetY) / scale;

      for (let i = nodes.length - 1; i >= 0; i--) {
        const node = nodes[i];
        const dx = transformedX - node.x;
        const dy = transformedY - node.y;
        const hitRadius = node.baseRadius * 1.5;
        if (dx * dx + dy * dy < hitRadius * hitRadius) {
          return node;
        }
      }
      return null;
    }

    function showPanel(node) {
      selectedNode = node;
      
      document.getElementById('panelCategory').textContent = node.category.toUpperCase();
      document.getElementById('panelTitle').textContent = node.title;
      document.getElementById('panelDate').textContent = node.date;
      document.getElementById('panelDescription').textContent = node.description;
      
      const tagsContainer = document.getElementById('panelTags');
      tagsContainer.innerHTML = node.tags.map(tag => 
        `<span class="project-tag">${tag}</span>`
      ).join('');

      panel.classList.add('visible');
    }

    function hidePanel() {
      panel.classList.remove('visible');
      selectedNode = null;
    }

    // Event listeners
    canvas.addEventListener('mousedown', (e) => {
      isDragging = true;
      dragStartX = e.clientX - offsetX;
      dragStartY = e.clientY - offsetY;
    });

    canvas.addEventListener('mousemove', (e) => {
      if (isDragging) {
        offsetX = e.clientX - dragStartX;
        offsetY = e.clientY - dragStartY;
      }

      const node = getNodeAtPosition(e.clientX, e.clientY);
      hoveredNode = node;
      canvas.style.cursor = node ? 'pointer' : 'grab';

      if (node) {
        tooltip.textContent = node.title;
        tooltip.style.left = e.clientX + 15 + 'px';
        tooltip.style.top = e.clientY + 15 + 'px';
        tooltip.classList.add('visible');
      } else {
        tooltip.classList.remove('visible');
      }
    });

    canvas.addEventListener('mouseup', () => {
      isDragging = false;
    });

    canvas.addEventListener('mouseleave', () => {
      isDragging = false;
      hoveredNode = null;
      tooltip.classList.remove('visible');
    });

    canvas.addEventListener('click', (e) => {
      const node = getNodeAtPosition(e.clientX, e.clientY);
      if (node) {
        showPanel(node);
      }
    });

    canvas.addEventListener('wheel', (e) => {
      e.preventDefault();
      const delta = e.deltaY > 0 ? 0.92 : 1.08;
      const newScale = Math.max(0.4, Math.min(2.5, scale * delta));
      
      // Zoom toward cursor
      const mouseX = e.clientX;
      const mouseY = e.clientY;
      offsetX = mouseX - (mouseX - offsetX) * (newScale / scale);
      offsetY = mouseY - (mouseY - offsetY) * (newScale / scale);
      scale = newScale;
    }, { passive: false });

    panelClose.addEventListener('click', hidePanel);

    // Touch events for mobile
    let touchStartX, touchStartY, lastTouchDist;

    canvas.addEventListener('touchstart', (e) => {
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX - offsetX;
        touchStartY = e.touches[0].clientY - offsetY;
      } else if (e.touches.length === 2) {
        lastTouchDist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
      }
    }, { passive: true });

    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (e.touches.length === 1) {
        offsetX = e.touches[0].clientX - touchStartX;
        offsetY = e.touches[0].clientY - touchStartY;
      } else if (e.touches.length === 2) {
        const dist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        const delta = dist / lastTouchDist;
        scale = Math.max(0.4, Math.min(2.5, scale * delta));
        lastTouchDist = dist;
      }
    }, { passive: false });

    canvas.addEventListener('touchend', (e) => {
      if (e.changedTouches.length === 1) {
        const node = getNodeAtPosition(
          e.changedTouches[0].clientX,
          e.changedTouches[0].clientY
        );
        if (node) showPanel(node);
      }
    });

    // Keyboard escape to close panel
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') hidePanel();
    });

    // Initialize
    window.addEventListener('resize', () => {
      resize();
    });

    resize();
    initNodes();
    draw();
  </script>
</body>
</html>
