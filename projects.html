<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  
  <title>Aadit Kannan | Projects</title>
  <meta name="title" content="Aadit Kannan | Projects">
  <meta name="description" content="Explore Aadit Kannan's engineering projects - from Formula Electric battery systems to robotics and web development.">
  <meta name="author" content="Aadit Kannan">
  <link rel="canonical" href="https://aaditkannan.com/projects">
  
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://aaditkannan.com/projects">
  <meta property="og:title" content="Aadit Kannan | Projects">
  <meta property="og:image" content="https://aaditkannan.com/assets/photo.jpg">
  
  <link rel="icon" type="image/svg+xml" href="/favicon-simple.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0a0a;
      --text: #fff;
      --text-dim: #888;
      --text-muted: #555;
      --border: rgba(255,255,255,0.08);
      --border-light: rgba(255,255,255,0.15);
    }

    html { 
      scroll-behavior: smooth;
      overflow-y: scroll;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    html::-webkit-scrollbar { display: none; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      line-height: 1.6;
      overflow-y: scroll;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    body::-webkit-scrollbar { display: none; }

    /* Nav - matching other pages */
    .nav-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1001;
      padding: 24px 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px;
      background: transparent;
      height: 80px;
      box-sizing: border-box;
    }

    .nav-link {
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      font-family: 'Courier Prime', 'JetBrains Mono', 'Courier New', monospace;
      border-bottom: 1px solid transparent;
      padding: 8px 0;
      transition: all 0.3s ease;
      line-height: 1;
    }

    .nav-link:hover { color: #FFFFFF; border-bottom-color: rgba(255, 255, 255, 0.5); }
    .nav-link.active { color: #FFFFFF; border-bottom-color: #FFFFFF; }

    /* Main content */
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 140px 40px 100px;
    }

    .page-header {
      margin-bottom: 48px;
    }

    .page-title {
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.7);
      font-family: 'Courier Prime', 'JetBrains Mono', 'Courier New', monospace;
    }

    /* Project grid */
    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
    }

    .project-card {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
      cursor: pointer;
      overflow: hidden;
    }

    .project-card:hover {
      border-color: var(--border-light);
      background: rgba(255,255,255,0.03);
    }

    .project-image {
      width: 100%;
      aspect-ratio: 16/10;
      background: rgba(255,255,255,0.02);
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid var(--border);
      overflow: hidden;
    }

    .project-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .project-image-placeholder {
      color: var(--text-muted);
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      font-family: 'Courier Prime', monospace;
    }

    .project-content {
      padding: 24px;
    }

    .project-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .project-category {
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
      font-family: 'Courier Prime', monospace;
    }

    .project-date {
      font-size: 12px;
      color: var(--text-muted);
      font-family: 'Courier Prime', monospace;
    }

    .project-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      letter-spacing: -0.01em;
    }

    .project-excerpt {
      font-size: 14px;
      color: var(--text-dim);
      line-height: 1.6;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .project-card.featured {
      grid-column: span 2;
    }

    .project-card.featured .project-image {
      aspect-ratio: 2/1;
    }

    .project-card.featured .project-title {
      font-size: 24px;
    }

    /* Active indicator */
    .status-dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #22c55e;
      margin-right: 6px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Sub-project count badge */
    .subproject-count {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      background: rgba(255,255,255,0.06);
      border-radius: 3px;
      font-size: 10px;
      color: var(--text-dim);
      font-family: 'Courier Prime', monospace;
      margin-left: 8px;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.visible {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      background: #0a0a0a;
      border: 1px solid var(--border);
      z-index: 201;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal.visible {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      background: rgba(0,0,0,0.5);
      border: 1px solid var(--border);
      cursor: pointer;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close::before,
    .modal-close::after {
      content: '';
      position: absolute;
      width: 14px;
      height: 1px;
      background: #fff;
    }
    .modal-close::before { transform: rotate(45deg); }
    .modal-close::after { transform: rotate(-45deg); }

    /* Gallery */
    .modal-gallery {
      width: 100%;
      position: relative;
      flex-shrink: 0;
      border-bottom: 1px solid var(--border);
    }

    .gallery-main {
      width: 100%;
      aspect-ratio: 2/1;
      background: rgba(255,255,255,0.02);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .gallery-main img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #000;
      cursor: zoom-in;
    }

    .gallery-main-placeholder {
      color: var(--text-muted);
      font-size: 11px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-family: 'Courier Prime', monospace;
    }

    .gallery-thumbs {
      display: flex;
      gap: 2px;
      padding: 2px;
      background: rgba(0,0,0,0.5);
      overflow-x: auto;
    }

    .gallery-thumb {
      width: 80px;
      height: 50px;
      flex-shrink: 0;
      background: rgba(255,255,255,0.03);
      border: 2px solid transparent;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.2s;
      opacity: 0.5;
    }

    .gallery-thumb:hover {
      opacity: 0.8;
    }

    .gallery-thumb.active {
      border-color: #fff;
      opacity: 1;
    }

    .gallery-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      background: rgba(0,0,0,0.6);
      border: 1px solid var(--border);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      z-index: 5;
    }

    .gallery-nav:hover {
      background: rgba(0,0,0,0.8);
      border-color: var(--border-light);
    }

    .gallery-nav.prev { left: 12px; }
    .gallery-nav.next { right: 12px; }

    .gallery-nav svg {
      width: 16px;
      height: 16px;
      fill: #fff;
    }

    .gallery-counter {
      position: absolute;
      bottom: 60px;
      right: 12px;
      padding: 4px 10px;
      background: rgba(0,0,0,0.7);
      font-size: 11px;
      font-family: 'Courier Prime', monospace;
      color: var(--text-dim);
    }

    .modal-body {
      padding: 32px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-header {
      margin-bottom: 20px;
    }

    .modal-category {
      font-size: 10px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-dim);
      font-family: 'Courier Prime', monospace;
      margin-bottom: 8px;
    }

    .modal-title {
      font-size: 28px;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 8px;
    }

    .modal-date {
      font-size: 13px;
      color: var(--text-dim);
      font-family: 'Courier Prime', monospace;
    }

    .modal-description {
      font-size: 15px;
      line-height: 1.8;
      color: rgba(255,255,255,0.75);
      margin-bottom: 24px;
    }

    .modal-links {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }

    .modal-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-dim);
      text-decoration: none;
      font-size: 12px;
      font-family: 'Courier Prime', monospace;
      transition: all 0.2s;
    }

    .modal-link:hover {
      border-color: var(--border-light);
      color: #fff;
    }

    .modal-link svg {
      width: 14px;
      height: 14px;
      fill: currentColor;
    }

    .modal-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 32px;
    }

    .modal-tag {
      padding: 6px 12px;
      border: 1px solid var(--border);
      font-size: 11px;
      color: var(--text-muted);
      font-family: 'Courier Prime', monospace;
    }

    /* Sub-projects section */
    .subprojects-section {
      border-top: 1px solid var(--border);
      padding-top: 28px;
    }

    .subprojects-title {
      font-size: 11px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-dim);
      font-family: 'Courier Prime', monospace;
      margin-bottom: 20px;
    }

    .subproject-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .subproject-item {
      display: flex;
      gap: 16px;
      padding: 16px;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      transition: all 0.2s;
    }

    .subproject-item:hover {
      border-color: var(--border-light);
    }

    .subproject-image {
      width: 120px;
      height: 80px;
      flex-shrink: 0;
      background: rgba(255,255,255,0.03);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .subproject-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .subproject-image-placeholder {
      font-size: 9px;
      color: var(--text-muted);
      font-family: 'Courier Prime', monospace;
      letter-spacing: 0.1em;
    }

    .subproject-content {
      flex: 1;
      min-width: 0;
    }

    .subproject-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 6px;
      gap: 12px;
    }

    .subproject-name {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .subproject-date {
      font-size: 11px;
      color: var(--text-muted);
      font-family: 'Courier Prime', monospace;
      white-space: nowrap;
    }

    .subproject-desc {
      font-size: 13px;
      color: var(--text-dim);
      line-height: 1.5;
    }

    .subproject-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-dim);
      text-decoration: none;
      font-family: 'Courier Prime', monospace;
    }

    .subproject-link:hover {
      color: #fff;
    }

    .subproject-link svg {
      width: 12px;
      height: 12px;
      fill: currentColor;
    }

    /* Lightbox */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      z-index: 300;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .lightbox.visible {
      opacity: 1;
      visibility: visible;
    }

    .lightbox img {
      max-width: 95%;
      max-height: 95%;
      object-fit: contain;
    }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: transparent;
      border: 1px solid var(--border);
      cursor: pointer;
    }

    .lightbox-close::before,
    .lightbox-close::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 18px;
      height: 1px;
      background: #fff;
    }
    .lightbox-close::before { transform: translate(-50%, -50%) rotate(45deg); }
    .lightbox-close::after { transform: translate(-50%, -50%) rotate(-45deg); }

    /* Responsive */
    @media (max-width: 768px) {
      .nav-bar {
        padding: 20px 24px;
        gap: 20px;
      }
      .nav-link { font-size: 11px; }
      
      main { padding: 120px 24px 80px; }
      
      .projects-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .project-card.featured {
        grid-column: span 1;
      }
      
      .project-card.featured .project-image {
        aspect-ratio: 16/10;
      }
      
      .modal {
        width: 95%;
        max-height: 90vh;
      }
      
      .modal-body { padding: 24px; }
      .modal-title { font-size: 22px; }

      .subproject-item {
        flex-direction: column;
      }

      .subproject-image {
        width: 100%;
        height: 120px;
      }

      .gallery-nav { display: none; }
      .gallery-thumb { width: 60px; height: 40px; }
    }
  </style>
</head>
<body>
  <nav class="nav-bar">
    <a href="/" class="nav-link">HOME</a>
    <a href="/resume" class="nav-link">RESUME</a>
    <a href="/projects" class="nav-link active">PROJECTS</a>
    <a href="/connect" class="nav-link">CONNECT</a>
    <a href="/footage" class="nav-link">FOOTAGE</a>
  </nav>

  <main>
    <header class="page-header">
      <h1 class="page-title">PROJECTS</h1>
    </header>

    <div class="projects-grid" id="projectsGrid"></div>
  </main>

  <div class="modal-overlay" id="modalOverlay"></div>
  <div class="modal" id="modal">
    <button class="modal-close" id="modalClose"></button>
    <div class="modal-gallery" id="modalGallery"></div>
    <div class="modal-body" id="modalBody"></div>
  </div>

  <div class="lightbox" id="lightbox">
    <button class="lightbox-close" id="lightboxClose"></button>
    <img id="lightboxImg" src="" alt="">
  </div>

  <script>
    const projects = [
      {
        id: 'formula-electric',
        title: 'Formula Electric',
        category: 'Hardware',
        date: 'Jan 2025 — Present',
        active: true,
        featured: true,
        excerpt: 'High-voltage battery system for Berkeley\'s Formula Electric racing team.',
        description: 'Designed and manufactured the attic casing for the high-voltage accumulator (battery) for Berkeley\'s Formula Electric racing team. Implemented waterproofing and high-dielectric-strength insulation to safely manage the 588V battery pack.',
        tags: ['Solidworks', 'Solidworks PDM', 'CAD/CAM/CAE'],
        links: [{ url: 'https://ev.berkeley.edu/', label: 'Team Website' }],
        images: [
          '/assets/img1.png',
          '/assets/img2.png',
          '/assets/img3.png'
        ],
        subprojects: []
      },
      {
        id: 'robotics-first',
        title: 'Robotics (FIRST)',
        category: 'Hardware',
        date: '2021 — 2025',
        active: false,
        featured: true,
        excerpt: 'Led two competitive robotics teams across 4 seasons, building 6 robots.',
        description: 'Four years of competitive robotics across two teams: Zenith #20424 and Deja Vu #13216. Progressed from team member to Hardware Lead to Captain, mentoring 30+ students, designing robots with 500+ parts, and winning multiple design awards.',
        tags: ['CAD', 'FEA', 'Java', 'Leadership', 'Mentoring'],
        links: [],
        images: [],
        subprojects: [
          {
            name: 'Zenith #20424 — Captain',
            date: '2024-25',
            desc: 'Led the team as Captain. Designed and built robot for INTO THE DEEP challenge.',
            image: '',
            link: { url: 'https://www.thebluealliance.com/team/20424/2025', label: 'View Season' }
          },
          {
            name: 'Zenith #20424 — Hardware Lead',
            date: '2023-24',
            desc: 'CENTERSTAGE season. Designed custom intake and scoring mechanisms.',
            image: '',
            link: { url: 'https://www.thebluealliance.com/team/20424/2024', label: 'View Season' }
          },
          {
            name: 'Deja Vu #13216 — Hardware Lead',
            date: '2022-23',
            desc: 'POWERPLAY season. Won Inspire Award, designed robot with 500+ custom parts.',
            image: '',
            link: { url: 'https://www.thebluealliance.com/team/13216/2023', label: 'View Season' }
          },
          {
            name: 'Deja Vu #13216 — Member',
            date: '2021-22',
            desc: 'FREIGHT FRENZY season. First year on the team, learned CAD and manufacturing.',
            image: '',
            link: { url: 'https://www.thebluealliance.com/team/13216/2022', label: 'View Season' }
          }
        ]
      },
      {
        id: 'inventry',
        title: 'Inventry',
        category: 'Software',
        date: 'Jan 2025 — Present',
        active: true,
        excerpt: 'AI-powered robotics parts inventory and marketplace.',
        description: 'Developed a website for robotics part inventory tracking, utilizing AI invoice indexing and dynamic webscraping for 1000+ part catalogs. Integrated part-lending service with incentives and extensive privacy measures. Currently developing a parts marketplace.',
        tags: ['Web Dev', 'AI', 'Webscraping', 'Database'],
        links: [],
        images: [],
        subprojects: []
      },
      {
        id: 'pear-volunteering',
        title: 'Pear Volunteering',
        category: 'Software',
        date: 'Aug 2023 — May 2025',
        active: false,
        excerpt: 'Platform connecting 2000+ students with volunteer opportunities.',
        description: 'Developed an app and website to connect 2000+ students, 20+ event organizers, and school admin for volunteer opportunities. Implemented secure webhook/CMS-integrated system for scalable, high-volume data handling and encrypted user communication.',
        tags: ['App Dev', 'Web Dev', 'CMS', 'Security'],
        links: [],
        images: [],
        subprojects: []
      },
      {
        id: 'atlas-smr',
        title: 'Atlas SMR',
        category: 'Research',
        date: 'Mar — Jun 2024',
        active: false,
        excerpt: 'Interactive tool for evaluating nuclear reactor site feasibility.',
        description: 'Developed an interactive web tool to evaluate Small Modular Reactor (SMR) feasibility in rural areas, integrating geospatial data and weighted scoring to compare site viability. Added hybrid SMR–solar modeling to visualize energy demand, environmental constraints, and overall system potential.',
        tags: ['Web Dev', 'GIS', 'Energy', 'Data Viz'],
        links: [],
        images: [],
        subprojects: []
      },
      {
        id: 'construction-acclimation',
        title: 'Construction Acclimation',
        category: 'Research',
        date: 'Oct 2022 — Apr 2023',
        active: false,
        excerpt: 'Low-cost probe alternative to save $118M in city spending.',
        description: 'Gathered construction site data to develop alternative devices to costly acclimation probes, aiming to cut $118M from Palo Alto\'s spending. Built a website and functioning probe prototype that earned praise from city construction officials.',
        tags: ['Hardware', 'Data Collection', 'Web Dev'],
        links: [],
        images: [],
        subprojects: []
      },
      {
        id: 'beachsweep',
        title: 'Beachsweep',
        category: 'Hackathon',
        date: 'Nov 2023',
        active: false,
        excerpt: 'Drone-based beach cleanup coordination system.',
        description: 'Hackathon project designing a website for organizing drone beach cleanups. Utilized solar-powered drone docks that work to maintain beach cleanliness and collaborate with human initiatives. Designed a computer vision drone trash detection system.',
        tags: ['Drones', 'Computer Vision', 'Solar'],
        links: [],
        images: [],
        subprojects: []
      },
      {
        id: 'friendly-fires',
        title: 'Friendly Fires',
        category: 'Social Impact',
        date: 'Sep 2021 — Mar 2022',
        active: false,
        excerpt: 'Coal-seam fire detection system for mining safety.',
        description: 'Created a mining tool attachment consisting of a compact sensor array capable of consistently detecting coal-seam fires, aiming to save lives in dangerous and often neglected mining conditions.',
        tags: ['Sensors', 'Safety', 'Hardware'],
        links: [],
        images: [],
        subprojects: []
      },
      {
        id: 'prototype-flood',
        title: 'Prototype Ø Flood',
        category: 'Social Impact',
        date: 'Nov 2020 — May 2021',
        active: false,
        excerpt: 'Low-cost flood detection for Jakarta, Indonesia.',
        description: 'Designed a low-cost flood detection system intended for addressing the lack of alert technology in Jakarta, Indonesia. Won certificate of achievement from the American Society of Civil Engineers.',
        tags: ['Sensors', 'IoT', 'International'],
        links: [],
        images: [],
        subprojects: []
      }
    ];

    const icons = {
      link: '<svg viewBox="0 0 24 24"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>',
      prev: '<svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',
      next: '<svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>'
    };

    // Render grid
    const grid = document.getElementById('projectsGrid');
    grid.innerHTML = projects.map(p => `
      <div class="project-card${p.featured ? ' featured' : ''}" data-id="${p.id}">
        <div class="project-image">
          ${p.images && p.images.length > 0 
            ? `<img src="${p.images[0]}" alt="${p.title}" style="object-position: center 30%;">` 
            : '<span class="project-image-placeholder">Photo</span>'}
        </div>
        <div class="project-content">
          <div class="project-meta">
            <span class="project-category">${p.category}</span>
            <span class="project-date">${p.active ? '<span class="status-dot"></span>' : ''}${p.date}</span>
          </div>
          <h3 class="project-title">
            ${p.title}
            ${p.subprojects && p.subprojects.length > 0 ? `<span class="subproject-count">${p.subprojects.length} items</span>` : ''}
          </h3>
          <p class="project-excerpt">${p.excerpt}</p>
        </div>
      </div>
    `).join('');

    // Modal & Gallery state
    const modal = document.getElementById('modal');
    const overlay = document.getElementById('modalOverlay');
    const closeBtn = document.getElementById('modalClose');
    const modalBody = document.getElementById('modalBody');
    const modalGallery = document.getElementById('modalGallery');
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    const lightboxClose = document.getElementById('lightboxClose');

    let currentImages = [];
    let currentIndex = 0;

    function updateGallery() {
      if (currentImages.length === 0) {
        modalGallery.innerHTML = `
          <div class="gallery-main">
            <span class="gallery-main-placeholder">Project Photos</span>
          </div>
        `;
        return;
      }

      const thumbsHTML = currentImages.length > 1 
        ? `<div class="gallery-thumbs">
            ${currentImages.map((img, i) => `
              <div class="gallery-thumb${i === currentIndex ? ' active' : ''}" data-index="${i}">
                <img src="${img}" alt="Thumbnail ${i+1}">
              </div>
            `).join('')}
          </div>`
        : '';

      const navHTML = currentImages.length > 1
        ? `<button class="gallery-nav prev">${icons.prev}</button>
           <button class="gallery-nav next">${icons.next}</button>
           <div class="gallery-counter">${currentIndex + 1} / ${currentImages.length}</div>`
        : '';

      modalGallery.innerHTML = `
        <div class="gallery-main">
          <img src="${currentImages[currentIndex]}" alt="Project image" id="galleryMainImg">
        </div>
        ${thumbsHTML}
        ${navHTML}
      `;

      // Bind gallery events
      const mainImg = document.getElementById('galleryMainImg');
      if (mainImg) {
        mainImg.onclick = () => {
          lightboxImg.src = currentImages[currentIndex];
          lightbox.classList.add('visible');
        };
      }

      modalGallery.querySelectorAll('.gallery-thumb').forEach(thumb => {
        thumb.onclick = () => {
          currentIndex = parseInt(thumb.dataset.index);
          updateGallery();
        };
      });

      const prevBtn = modalGallery.querySelector('.gallery-nav.prev');
      const nextBtn = modalGallery.querySelector('.gallery-nav.next');
      if (prevBtn) prevBtn.onclick = () => { currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length; updateGallery(); };
      if (nextBtn) nextBtn.onclick = () => { currentIndex = (currentIndex + 1) % currentImages.length; updateGallery(); };
    }

    function openModal(id) {
      const p = projects.find(x => x.id === id);
      if (!p) return;

      currentImages = p.images || [];
      currentIndex = 0;
      updateGallery();

      let linksHTML = '';
      if (p.links.length > 0) {
        linksHTML = `<div class="modal-links">${p.links.map(l => 
          `<a href="${l.url}" target="_blank" rel="noopener" class="modal-link">${icons.link}${l.label}</a>`
        ).join('')}</div>`;
      }

      let subprojectsHTML = '';
      if (p.subprojects && p.subprojects.length > 0) {
        subprojectsHTML = `
          <div class="subprojects-section">
            <h4 class="subprojects-title">Timeline — ${p.subprojects.length} Items</h4>
            <div class="subproject-list">
              ${p.subprojects.map(s => `
                <div class="subproject-item">
                  <div class="subproject-image">
                    ${s.image ? `<img src="${s.image}" alt="${s.name}">` : '<span class="subproject-image-placeholder">Photo</span>'}
                  </div>
                  <div class="subproject-content">
                    <div class="subproject-header">
                      <span class="subproject-name">${s.name}</span>
                      <span class="subproject-date">${s.date}</span>
                    </div>
                    <p class="subproject-desc">${s.desc}</p>
                    ${s.link ? `<a href="${s.link.url}" target="_blank" rel="noopener" class="subproject-link">${icons.link}${s.link.label}</a>` : ''}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      modalBody.innerHTML = `
        <div class="modal-header">
          <p class="modal-category">${p.category}</p>
          <h2 class="modal-title">${p.active ? '<span class="status-dot"></span>' : ''}${p.title}</h2>
          <p class="modal-date">${p.date}</p>
        </div>
        <p class="modal-description">${p.description}</p>
        ${linksHTML}
        <div class="modal-tags">${p.tags.map(t => `<span class="modal-tag">${t}</span>`).join('')}</div>
        ${subprojectsHTML}
      `;

      overlay.classList.add('visible');
      modal.classList.add('visible');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      overlay.classList.remove('visible');
      modal.classList.remove('visible');
      document.body.style.overflow = '';
    }

    function closeLightbox() {
      lightbox.classList.remove('visible');
    }

    grid.addEventListener('click', e => {
      const card = e.target.closest('.project-card');
      if (card) openModal(card.dataset.id);
    });

    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);
    lightboxClose.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', e => { if (e.target === lightbox) closeLightbox(); });

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        if (lightbox.classList.contains('visible')) closeLightbox();
        else closeModal();
      }
      if (modal.classList.contains('visible') && currentImages.length > 1) {
        if (e.key === 'ArrowLeft') { currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length; updateGallery(); }
        if (e.key === 'ArrowRight') { currentIndex = (currentIndex + 1) % currentImages.length; updateGallery(); }
      }
    });
  </script>
</body>
</html>
